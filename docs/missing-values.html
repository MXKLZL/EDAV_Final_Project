<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Missing values | YOUR TITLE HERE</title>
  <meta name="description" content="Chapter 4 Missing values | YOUR TITLE HERE" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Missing values | YOUR TITLE HERE" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Missing values | YOUR TITLE HERE" />
  
  
  

<meta name="author" content="Yichi Zhang, Zelin Li, Huayun Xu, Mingfang Chang" />


<meta name="date" content="2019-12-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-transformation.html"/>
<link rel="next" href="results.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SHORT TITLE HERE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i><b>2</b> Data sources</a></li>
<li class="chapter" data-level="3" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>3</b> Data transformation</a></li>
<li class="chapter" data-level="4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>4</b> Missing values</a></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a></li>
<li class="chapter" data-level="6" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>6</b> Interactive component</a></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="chapter" data-level="8" data-path="leaflet.html"><a href="leaflet.html"><i class="fa fa-check"></i><b>8</b> Interactive Geographic Data</a><ul>
<li class="chapter" data-level="8.1" data-path="leaflet.html"><a href="leaflet.html#overview"><i class="fa fa-check"></i><b>8.1</b> Overview</a></li>
<li class="chapter" data-level="8.2" data-path="leaflet.html"><a href="leaflet.html#brief-description-about-dataset"><i class="fa fa-check"></i><b>8.2</b> Brief Description about Dataset</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">YOUR TITLE HERE</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="missing-values" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Missing values</h1>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">df_cols &lt;-<span class="st"> </span><span class="kw">colnames</span>(df_select)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">df &lt;-<span class="st"> </span>df_select <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CMPLNT_FR_DT=</span><span class="kw">as.Date</span>(CMPLNT_FR_DT, <span class="st">&quot;%m/%d/%Y&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(CMPLNT_FR_DT <span class="op">&gt;=</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;01/01/2018&quot;</span>, <span class="st">&quot;%m/%d/%Y&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#df &lt;- df %&gt;% select(-timerange, -color, -crimecolor)</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">SUSP_AGE_GROUP =</span> <span class="kw">ifelse</span>(SUSP_AGE_GROUP <span class="op">==</span><span class="st"> &quot;UNKNOWN&quot;</span>, <span class="ot">NA</span>, SUSP_AGE_GROUP))</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">SUSP_RACE =</span> <span class="kw">ifelse</span>(SUSP_RACE <span class="op">==</span><span class="st"> &quot;UNKNOWN&quot;</span>, <span class="ot">NA</span>, SUSP_RACE))</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">VIC_AGE_GROUP =</span> <span class="kw">ifelse</span>(VIC_AGE_GROUP <span class="op">==</span><span class="st"> &quot;UNKNOWN&quot;</span>, <span class="ot">NA</span>, VIC_AGE_GROUP))</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">VIC_RACE =</span> <span class="kw">ifelse</span>(VIC_RACE <span class="op">==</span><span class="st"> &quot;UNKNOWN&quot;</span>, <span class="ot">NA</span>, VIC_RACE))</a></code></pre></div>
<p>We have randomly sampled 1000 data to analysis the missing value pattern of the dataset after we have cleaned the data. We have also changed the “UNKNOWN” entry to NA.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">vis_miss</span>(df)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>From the plot above, we see that majority of missing data came from the columns: “SUSP_AGE_GEOUP”, “SUSP_SEX”, “SUSP_RACE”, “VIC_AGE_GROUP”, “VIC_RACE”, “Latitude”, and “Longitude”. We also see that “Latitude”, and “Longitude” are always missing together.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">df<span class="op">$</span>CMPLNT_FR_DT &lt;-<span class="st"> </span><span class="kw">as.character</span>(df<span class="op">$</span>CMPLNT_FR_DT)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">df<span class="op">$</span>CMPLNT_FR_TM &lt;-<span class="st"> </span><span class="kw">as.character</span>(df<span class="op">$</span>CMPLNT_FR_TM)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">names</span>(df) &lt;-<span class="st"> </span>df_cols</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw">missing_data.frame</span>(df)</a></code></pre></div>
<pre><code>## NOTE: In the following pairs of variables, the missingness pattern of the second is a subset of the first.
##  Please verify whether they are in fact logically distinct variables.
##      [,1]             [,2]      
## [1,] &quot;SUSP_AGE_GROUP&quot; &quot;SUSP_SEX&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">summary</span>(x<span class="op">@</span>patterns) </a></code></pre></div>
<pre><code>##                                                                           nothing 
##                                                                                18 
##                                                                          VIC_RACE 
##                                                                                 2 
##                                                                    SUSP_AGE_GROUP 
##                                                                                 4 
##                                                                     VIC_AGE_GROUP 
##                                                                                 1 
##                                                               Latitude, Longitude 
##                                                                               140 
##                                                         SUSP_AGE_GROUP, SUSP_RACE 
##                                                                                 8 
##                                                           VIC_AGE_GROUP, VIC_RACE 
##                                                                                17 
##                                               SUSP_AGE_GROUP, Latitude, Longitude 
##                                                                                62 
##                                               SUSP_AGE_GROUP, SUSP_SEX, SUSP_RACE 
##                                                                                15 
##                                                    SUSP_RACE, Latitude, Longitude 
##                                                                                 9 
##                                                VIC_AGE_GROUP, Latitude, Longitude 
##                                                                                 6 
##                                                     VIC_RACE, Latitude, Longitude 
##                                                                                 5 
##                                               SUSP_AGE_GROUP, SUSP_RACE, VIC_RACE 
##                                                                                 1 
##                                           SUSP_AGE_GROUP, VIC_AGE_GROUP, VIC_RACE 
##                                                                                 2 
##                                      VIC_AGE_GROUP, VIC_RACE, Latitude, Longitude 
##                                                                               176 
##                                    SUSP_AGE_GROUP, SUSP_RACE, Latitude, Longitude 
##                                                                               171 
##                                SUSP_AGE_GROUP, SUSP_RACE, VIC_AGE_GROUP, VIC_RACE 
##                                                                                 1 
##                                SUSP_AGE_GROUP, VIC_AGE_GROUP, Latitude, Longitude 
##                                                                                 2 
##                                       BORO_NM, PREM_TYP_DESC, Latitude, Longitude 
##                                                                                 2 
##                                     SUSP_AGE_GROUP, VIC_RACE, Latitude, Longitude 
##                                                                                 3 
##                                          SUSP_RACE, VIC_RACE, Latitude, Longitude 
##                                                                                 1 
##                          SUSP_AGE_GROUP, SUSP_SEX, SUSP_RACE, Latitude, Longitude 
##                                                                               209 
##                      SUSP_AGE_GROUP, VIC_AGE_GROUP, VIC_RACE, Latitude, Longitude 
##                                                                                28 
##                          SUSP_AGE_GROUP, SUSP_RACE, VIC_RACE, Latitude, Longitude 
##                                                                                 6 
##                      SUSP_AGE_GROUP, SUSP_SEX, SUSP_RACE, VIC_AGE_GROUP, VIC_RACE 
##                                                                                 3 
##                           SUSP_RACE, VIC_AGE_GROUP, VIC_RACE, Latitude, Longitude 
##                                                                                 2 
##           SUSP_AGE_GROUP, SUSP_RACE, VIC_AGE_GROUP, VIC_RACE, Latitude, Longitude 
##                                                                                23 
##           SUSP_AGE_GROUP, PREM_TYP_DESC, SUSP_SEX, SUSP_RACE, Latitude, Longitude 
##                                                                                 2 
##                SUSP_AGE_GROUP, SUSP_SEX, SUSP_RACE, VIC_RACE, Latitude, Longitude 
##                                                                                 9 
##           SUSP_AGE_GROUP, SUSP_SEX, SUSP_RACE, VIC_AGE_GROUP, Latitude, Longitude 
##                                                                                 3 
## SUSP_AGE_GROUP, SUSP_SEX, SUSP_RACE, VIC_AGE_GROUP, VIC_RACE, Latitude, Longitude 
##                                                                                69</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#image(x)</span></a></code></pre></div>
<p>We can further investigate the missing row patterns by using the missing_data.frame function, and we found out that there are 30 different row missing patterns. Some of the patterns only have one or two ocurrences and 20 of them have 10 ocurrences or below.</p>
<p>We can check how many time each of the row missing pattern appears in the data set by the following and also visualize these row missing patterns with visna function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">visna</span>(df, <span class="dt">sort=</span><span class="st">&#39;r&#39;</span>)</a></code></pre></div>
<pre><code>## Warning in melt(as.data.frame(xs), ncol(xs)): The melt generic in
## data.table has been passed a data.frame and will attempt to redirect to the
## relevant reshape2 method; please note that reshape2 is deprecated, and this
## redirection is now deprecated as well. To continue using melt methods from
## reshape2 while both libraries are attached, e.g. melt.list, you can prepend
## the namespace like reshape2::melt(as.data.frame(xs)). In the next version,
## this warning will become an error.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>By using the visna function, we observed the following missing row patterns:</p>
<ol style="list-style-type: decimal">
<li>The pattern that occurs the most is missing both Latitude and Longitude, which is about 91.5% of the data.</li>
<li>The information of the suspect are missing such as age, sex, and race tends to be missing along with some other variables.</li>
</ol>
<p>Since the objective of our project is to analysis the safty issue, when doing the interative part of the project, we will need to use the location information. So we have to drop all the data with Longitude and Latitude missing. This might affect the distribution of the crime, so we plotted the following diagram to compare the distribution of crime type before and after when location is removed.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">ggplot</span>(df_select, <span class="kw">aes</span>(<span class="dt">x=</span>OFNS_DESC, <span class="dt">y=</span>..count..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Count by crime type&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">df_locationNA_dropped &lt;-<span class="st"> </span>df_select <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(Latitude)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">ggplot</span>(df_locationNA_dropped, <span class="kw">aes</span>(<span class="dt">x=</span>OFNS_DESC, <span class="dt">y=</span>..count..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Count by crime type with location NA dropped&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-51-2.png" width="672" /></p>
<p>Base on the above two plots, we see that after we have removed all the data that are missing location, the distribution of the crime type is unchanged. So, the missing of location is somewhat random and we are safe to remove it when doing the interactive part.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-transformation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/edit/master/04-missing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/blob/master/04-missing.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
