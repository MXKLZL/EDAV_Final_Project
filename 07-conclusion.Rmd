# Conclusion

# Interactive Geographic Data {#leaflet}

![](images/banners/banner_leaflet.png)
*This chapter originated as a community contribution created by [ AkhilPunia](https://github.com/AkhilPunia){target="_blank"}*

*This page is a work in progress. We appreciate any input you may have. If you would like to help improve this page, consider [contributing to our repo](contribute.html).*

## Overview

You would have already seen different libraries that can help one in beautifully displaying geographic data like `ggmap` and `choroplethr`. Even though these libraries provide lots of interesting features to better express information through 2-dimensional graphs, they still lack one feature: interactivity. Here comes `leaflet`---a library written in javascript to handle interactive maps. Fun Fact: It's actively used by a lot of leading newspapers like The New York Times and The Washington Post. 
Let's dive in.

## Brief Description about Dataset
For our analysis, we are using NYC Open Data about schools in New York City in 2016. [You can find more about it on the Kaggle page.](https://www.kaggle.com/passnyc/data-science-for-good/home){target="_blank"} We will be focusing on the the distribution of different variables as a factor of geographical positions.

```{r load library, eval=TRUE, message=FALSE}
library(tidyverse)
library(leaflet)
library(htmltools)
library(leaflet.extras)
library(viridis)
#schools <- read_csv('2016_school_explorer.csv')
```

```{r}
quakes
```

```{r}
df <- df_select %>% drop_na(Latitude, Longitude)
df.df <- split(df, df$timerange)

l <- leaflet() %>% addTiles()

names(df.df) %>%
  purrr::walk( function(df) {
    print(df)
    l <<- l %>%
      addMarkers(data=df.df[[df]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          popup=~OFNS_DESC,
                          group = df,
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = F),
                          labelOptions = labelOptions(noHide = F,
                                                       direction = 'auto'))
  })

l %>%
  addLayersControl(
    overlayGroups = names(df.df),
    options = layersControlOptions(collapsed = FALSE)
  )
```


```{r}


map <- leaflet(df) %>% 
  addTiles() %>% 
  addCircleMarkers(~Longitude, ~Latitude, 2, group=~timerange, color=~color, opacity=0.3, label =  ~OFNS_DESC, clusterOptions = markerClusterOptions()) %>% 
  addLayersControl(
    overlayGroups= c("07am - 11am", "15pm - 19pm", "19pm - 23pm"), 
    options = layersControlOptions(collapsed = FALSE),
    
  )
map
```


```{r}
df <- df_select %>% drop_na(Latitude, Longitude)

map <- leaflet(df) %>% 
  addTiles() %>% 
  addCircles(~Longitude, ~Latitude, 10, group=~timerange, color=~color, opacity=0.3, label =  ~OFNS_DESC) %>% 
  addLayersControl(
    overlayGroups= c("07am - 11am", "15pm - 19pm", "19pm - 23pm"), 
    options = layersControlOptions(collapsed = FALSE),
    
  )
map
```

```{r}
library(purrr)
df <- df_select %>% drop_na(Latitude, Longitude)
Y <- split(df, df$timerange)

leaf <- leaflet() %>% addTiles()

leaf <- leaf %>%
      addMarkers(data=Y[[1]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          popup=~OFNS_DESC,
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "07am - 11am"
                          )
     
leaf <- leaf %>%addMarkers(data=Y[[2]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          popup=~OFNS_DESC,
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "15pm - 19pm"

                          )
leaf <- leaf %>%
     addMarkers(data=Y[[3]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          popup=~OFNS_DESC,
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "19pm - 23pm"
                          )

leaf %>%
  addLayersControl(
    overlayGroups = c("07am - 11am", "15pm - 19pm","19pm - 23pm"),
    options = layersControlOptions(collapsed = FALSE)
  )

```





```{r}

df <- df_select %>% drop_na(Latitude, Longitude)

map <- leaflet(df) %>% 
  addTiles() %>% 
  addCircles(~Longitude, ~Latitude, 10, group=~OFNS_DESC, color=~crime_color, opacity=1, label =  ~OFNS_DESC) %>% 
  addLayersControl(
    overlayGroups= c('BURGLARY'), 
    options = layersControlOptions(collapsed = FALSE),
    
  )
map
```




```{r}
TYPE <- split(df, df$OFNS_DESC)

leaftype <- leaflet() %>% addTiles()


#paste (~VIC_AGE_GROUP, sep = " ", collapse = NULL)

#TYPE[[1]]$VIC_AGE_GROUP
#cat('a','b',sep = '\n')

leaftype <- leaftype %>%
      addMarkers(data=TYPE[[1]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste(paste("Victim Age: ",TYPE[[1]]$VIC_AGE_GROUP),
                                       paste(", Time: ",TYPE[[1]]$timerange),sep = '\n'),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "BURGLARY"
                          )
     
leaftype <- leaftype %>%addMarkers(data=TYPE[[2]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste(paste("Victim Age: ",TYPE[[2]]$VIC_AGE_GROUP),
                                       paste(", Time: ",TYPE[[2]]$timerange),sep = '\n'),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "OFFENSE"

                          )
leaftype <- leaftype %>%
     addMarkers(data=TYPE[[3]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste(paste("Victim Age: ",TYPE[[3]]$VIC_AGE_GROUP),
                                       paste(", Time: ",TYPE[[3]]$timerange),sep = '\n'),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "RAPE"
                          )


leaftype <- leaftype %>%
     addMarkers(data=TYPE[[4]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste(paste("Victim Age: ",TYPE[[4]]$VIC_AGE_GROUP),
                                       paste(", Time: ",TYPE[[4]]$timerange),sep = '\n'),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "ROBBERY"
                          )
leaftype <- leaftype %>%
     addMarkers(data=TYPE[[5]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste(paste("Victim Age: ",TYPE[[5]]$VIC_AGE_GROUP),
                                       paste(", Time: ",TYPE[[5]]$timerange),sep = '\n'),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "THIEF"
                          )
leaftype <- leaftype %>%
     addMarkers(data=TYPE[[6]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste(paste("Victim Age: ",TYPE[[6]]$VIC_AGE_GROUP),
                                       paste(", Time: ",TYPE[[6]]$timerange),sep = '\n'),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "WEAPON"
                          )

leaftype %>%
  addLayersControl(
    overlayGroups = c("BURGLARY","OFFENSE","RAPE","ROBBERY","THIEF","WEAPON"),
    options = layersControlOptions(collapsed = FALSE)
  )
```







```{r}
df <- df_select %>% drop_na(Latitude, Longitude)
TYPE <- split(df, df$OFNS_DESC)
TYPE[[1]]

leaftype <- leaflet() %>% addTiles()


#addCircles(~Longitude, ~Latitude, 10, group=~OFNS_DESC, color=~crime_color, opacity=1, label =  ~OFNS_DESC)


leaftype <- leaftype %>%
      addCircles(data=TYPE[[1]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          weight = 10,
                          opacity=1,
                          color="red",
                          group = "BURGLARY"
                          )
     
leaftype <- leaftype %>%addCircles(data=TYPE[[2]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          weight = 10,
                          opacity=1,
                          color="orange",
                          group = "OFFENSE"

                          )
leaftype <- leaftype %>%
     addCircles(data=TYPE[[3]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          weight = 10,
                          opacity=1,
                          color="pink",
                          group = "RAPE"
                          )


leaftype <- leaftype %>%
     addCircles(data=TYPE[[4]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          weight = 10,
                          opacity=1,
                          color="blue",
                          group = "ROBBERY"
                          )
leaftype <- leaftype %>%
     addCircles(data=TYPE[[5]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          weight = 10,
                          opacity=1,
                          color="green",
                          group = "THIEF"
                          )
leaftype <- leaftype %>%
     addCircles(data=TYPE[[6]],
                          lng=~Longitude, lat=~Latitude,
                          label=~OFNS_DESC,
                          weight = 10,
                          opacity=1,
                          color="white",
                          group = "WEAPON"
                          )

leaftype %>%
  addLayersControl(
    overlayGroups = c("BURGLARY","OFFENSE","RAPE","ROBBERY","THIEF","WEAPON"),
    options = layersControlOptions(collapsed = FALSE)
  )
```




