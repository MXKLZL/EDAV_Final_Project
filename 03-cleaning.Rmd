# Data transformation

## Fix error in the data
First of all, since we would like to analysis the occurance time and date of each record, we changed the type of column CMPLNT_FR_DT, CMPLNT_FR_TM to date and time. However, some crime records happend in long year age(like 1950s) but completeed recently are included in our dataset. In order to keep our data up to date, we drop all record happend before 2018-01-01. For severals error data such as record happend in 1018 or 1019, we fixed their date.

```{r include=FALSE}
library(tidyr)
library(tidyverse)
library(dplyr)
library(lubridate)
library(chron)
```

```{r echo=FALSE}
DATA <- read.csv("NYPD_Complaint_Data_Current__Year_To_Date_.csv",na.strings = "")

DATA <-DATA[!is.na(DATA$CMPLNT_FR_DT), ]
DATA$CMPLNT_FR_DT <-as.Date(DATA$CMPLNT_FR_DT,format = "%m/%d/%Y")

for(i in 1:nrow(DATA)){
  if(year(DATA[i,4]) =='1018'){year(DATA[i,4]) <-2018}
  if(year(DATA[i,4]) =='1019'){year(DATA[i,4]) <-2019}
  if(year(DATA[i,4]) =='1029'){year(DATA[i,4]) <-2019}
}

DATA$CMPLNT_FR_TM <-as.character(DATA$CMPLNT_FR_TM)
DATA$CMPLNT_FR_TM <-chron(times=DATA$CMPLNT_FR_TM)

df <- DATA %>%
  filter(CMPLNT_FR_DT >=as.Date('2018-01-01'))
```

## Pick out relevant crimes

Another goal of our exploration is to analysis the type of crime in each county. However, the some of crime description are too detailed. So we classifed all of them into 11 types based on broad definiton(like all offenses with different target are classied as offense). And drop all other type which have very low frequency and completely irrelavant to us such as gambling.

```{r echo=FALSE}
offense <- c('ANTICIPATORY OFFENSES', "OFF. AGNST PUB ORD SENSBLTY &", "OFFENSES AGAINST MARRIAGE UNCL", "OFFENSES AGAINST PUBLIC ADMINI", "OFFENSES AGAINST PUBLIC SAFETY", "OFFENSES AGAINST THE PERSON", "OFFENSES INVOLVING FRAUD", "OFFENSES RELATED TO CHILDREN", "OTHER OFFENSES RELATED TO THEF","HARASSMENT 2")
assault <- c('ASSAULT 3 & RELATED OFFENSES', 'FELONY ASSAULT')
burglary <- c('BURGLARY', "BURGLAR'S TOOLS", "CRIMINAL TRESPASS")
drug <- c("DANGEROUS DRUGS")
weapon <- c("DANGEROUS WEAPONS", "UNLAWFUL POSS. WEAP. ON SCHOOL" )
rape <- c("FELONY SEX CRIMES", "RAPE", "SEX CRIMES")
fraud <- c("FRAUDS", "FORGERY", "FRAUDULENT ACCOSTING", "THEFT-FRAUD")
theft <- c("GRAND LARCENY", "GRAND LARCENY OF MOTOR VEHICLE", "OTHER OFFENSES RELATED TO THEF", "PETIT LARCENY", "PETIT LARCENY OF MOTOR VEHICLE", "POSSESSION OF STOLEN PROPERTY", "THEFT OF SERVICES")
murder <- c("MURDER & NON-NEGL. MANSLAUGHTER")
kidnapping <- c("KIDNAPPING", "KIDNAPPING & RELATED OFFENSES", "KIDNAPPING AND RELATED OFFENSES")

picked <- c('ROBBERY', "OFFENSE", "ARSON", "BURGLARY", "DRUG", "WEAPON", "RAPE", "FRAUD", "THEFT", "MURDER", "KIDNAPPING")
df$OFNS_DESC <- as.character(df$OFNS_DESC)
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% offense, "OFFENSE", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% assault, "ASSAULT", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% drug, "DRUG", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% weapon, "WEAPON", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% rape, "RAPE", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% fraud, "FRAUD", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% theft, "THEFT", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% murder, "MURDER", OFNS_DESC))
df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% kidnapping, "KIDNAPPING", OFNS_DESC))

df <- df %>% mutate(OFNS_DESC = ifelse(OFNS_DESC %in% picked, OFNS_DESC, NA)) %>% drop_na(OFNS_DESC)
```

Since not all columns in original dataset are useful for our analysis. So we selected 13 columns we may used for following researchs which include the location, time, suspect information, victim information and the crime infomration.
```{r echo=FALSE}
cols <- c('BORO_NM', 'CMPLNT_FR_DT','CMPLNT_FR_TM','OFNS_DESC', 'SUSP_AGE_GROUP', 'PREM_TYP_DESC', 'SUSP_SEX', 'SUSP_RACE', 'VIC_AGE_GROUP', 'VIC_RACE', 'VIC_SEX', 'Latitude', 'Longitude')
df_select <- df[, cols]
```
