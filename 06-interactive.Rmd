# Interactive component



```{r eval=TRUE, message=FALSE}
library(tidyverse)
library(leaflet)
library(htmltools)
library(leaflet.extras)
library(viridis)
```

As we discussion in the last chapter, Queens and Mahattan shoud be the two best borough for us. However, the best choice are base on our critiera and we also doesn't compare the safety level of the specific address in eacy borough. The following two interactive graph provide several choose for both time period and crime type for the person with difference preference and help person identify the most safety address in each borough.



Different person may have different schdule. Some student may only have class in the afternoon so the time period they go to school should be 11am - 3pm. On the top right corner, there are several check boxes. The audience may choose some time period based on their own schedule. And the crime distribution in New York City for the selected time period will appear in the map. The number in each circle show the total number of crime arround the address near address. You can click the circle show on the graph to zoom into smaller scope. Eventually, when the zoom become smaller enough, the circle will become pin push in graph and if you click the pin push, it will show you the exact crime time, victim age group, victim sex, and victim race. 


```{r}

df <- df_select %>% drop_na(Latitude, Longitude)
Y <- split(df, df$timerange)

leaf <- leaflet() %>% addTiles()

leaf <- leaf %>%
      addMarkers(data=Y[[1]],
                          lng=~Longitude, lat=~Latitude,
                          popup=paste0(paste("Time: ",Y[[1]]$CMPLNT_FR_TM),"</strong><br />",paste("Type: ",Y[[1]]$OFNS_DESC),"</strong><br />",
                                       paste("Victim Age: ",Y[[1]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",Y[[1]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",Y[[1]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "7am - 11am"
                          )

 leaf <- leaf %>%addMarkers(data=Y[[2]],
                           lng=~Longitude, lat=~Latitude,
                           popup=paste0(paste("Time: ",Y[[2]]$CMPLNT_FR_TM),"</strong><br />",paste("Type: ",Y[[2]]$OFNS_DESC),"</strong><br />",
                                       paste("Victim Age: ",Y[[2]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",Y[[2]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",Y[[2]]$VIC_RACE)),
                           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                           labelOptions = labelOptions(direction = 'auto'),
                           group = "11am - 3pm"
 
                           )
     
leaf <- leaf %>%addMarkers(data=Y[[3]],
                          lng=~Longitude, lat=~Latitude,
                          popup=paste0(paste("Time: ",Y[[3]]$CMPLNT_FR_TM),"</strong><br />",paste("Type: ",Y[[3]]$OFNS_DESC),"</strong><br />",
                                       paste("Victim Age: ",Y[[3]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",Y[[3]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",Y[[3]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "3pm - 7pm"

                          )
leaf <- leaf %>%
     addMarkers(data=Y[[4]],
                          lng=~Longitude, lat=~Latitude,
                          popup=paste0(paste("Time: ",Y[[4]]$CMPLNT_FR_TM),"</strong><br />",paste("Type: ",Y[[4]]$OFNS_DESC),"</strong><br />",
                                       paste("Victim Age: ",Y[[4]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",Y[[4]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",Y[[4]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "7pm - 11pm"
                          )



leaf %>%
  addLayersControl(
    overlayGroups = c("7am - 11am", "11am - 3pm","3pm - 7pm","7pm - 11pm"),
    options = layersControlOptions(collapsed = FALSE)
  )

```







Different person may have different rank of dangerousness of the crime types. For Female, they may afraid of Rape more and want to choose address with no or extremely low Rape rate. For Male, they may want to live in place have less burglary and robberry. There are several check boxes on the top right corner and user may choose the subset of crime type to choose the exactly address in each borough based on there own crime rank. Same as the graph above, You can click the circle continuesly to zoom into smaller scope and click the pin push, it will show you the exact crime time, victim age group, victim sex, and victim race.  



```{r}
TYPE <- split(df, df$OFNS_DESC)

leaftype <- leaflet() %>% addTiles()


leaftype <- leaftype %>%
      addMarkers(data=TYPE[[1]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste0(paste("Time: ",TYPE[[1]]$CMPLNT_FR_TM),"</strong><br />",
                                       paste("Victim Age: ",TYPE[[1]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",TYPE[[1]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",TYPE[[1]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "BURGLARY"
                          )
     
leaftype <- leaftype %>%addMarkers(data=TYPE[[2]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste0(paste("Time: ",TYPE[[2]]$CMPLNT_FR_TM),"</strong><br />",
                                       paste("Victim Age: ",TYPE[[2]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",TYPE[[2]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",TYPE[[2]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "OFFENSE"

                          )
leaftype <- leaftype %>%
     addMarkers(data=TYPE[[3]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste0(paste("Time: ",TYPE[[3]]$CMPLNT_FR_TM),"</strong><br />",
                                       paste("Victim Age: ",TYPE[[3]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",TYPE[[3]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",TYPE[[3]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "RAPE"
                          )


leaftype <- leaftype %>%
     addMarkers(data=TYPE[[4]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste0(paste("Time: ",TYPE[[4]]$CMPLNT_FR_TM),"</strong><br />",
                                       paste("Victim Age: ",TYPE[[4]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",TYPE[[4]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",TYPE[[4]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "ROBBERY"
                          )
leaftype <- leaftype %>%
     addMarkers(data=TYPE[[5]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste0(paste("Time: ",TYPE[[5]]$CMPLNT_FR_TM),"</strong><br />",
                                       paste("Victim Age: ",TYPE[[5]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",TYPE[[5]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",TYPE[[5]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "THEFT"
                          )
leaftype <- leaftype %>%
     addMarkers(data=TYPE[[6]],
                          lng=~Longitude, lat=~Latitude,
                          label =~OFNS_DESC , 
                          popup=paste0(paste("Time: ",TYPE[[6]]$CMPLNT_FR_TM),"</strong><br />",
                                       paste("Victim Age: ",TYPE[[6]]$VIC_AGE_GROUP),
                                       "</strong><br />",paste("Victim Sex: ",TYPE[[6]]$VIC_SEX),
                                       "</strong><br />",
                                       paste("Victim Race: ",TYPE[[6]]$VIC_RACE)),
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),
                          labelOptions = labelOptions(direction = 'auto'),
                          group = "WEAPON"
                          )

leaftype %>%
  addLayersControl(
    overlayGroups = c("BURGLARY","OFFENSE","RAPE","ROBBERY","THEFT","WEAPON"),
    options = layersControlOptions(collapsed = FALSE)
  )
```



